<!-- frontend/game_management.html - GERENCIADOR DE JOGOS .LUA CORRIGIDO E INTEGRADO -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steam GameLoader | Gerenciador de Jogos .LUA</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
    <style>
        /* ====== ESTILOS ESPEC√çFICOS PARA GAME MANAGEMENT CORRIGIDO ====== */
        :root {
            --header-height: 80px;
            --sidebar-width: 280px;
            --transition-smooth: 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            
            /* Cores Steam */
            --steam-dark: #171a21;
            --steam-blue: #1b2838;
            --steam-light-blue: #2a475e;
            --steam-accent: #66c0f4;
            --steam-text: #c7d5e0;
            --steam-green: #5ba32b;
            --steam-orange: #e35e1c;
            
            /* Mesclando com a paleta atual */
            --primary-purple: #7a2aff;
            --neon-purple: #bb33ff;
            --neon-cyan: #00f3ff;
            --neon-pink: #ff2a6d;
            --electric-blue: #4de0ff;
            --success-green: #00ff88;
            --warning-orange: #ffaa00;
            --danger-red: #ff2a2a;
            
            /* Cores de fundo atualizadas */
            --bg-primary: #0a0814;
            --bg-secondary: #0f0c1f;
            --bg-tertiary: #151225;
            --bg-card: rgba(20, 15, 35, 0.8);
            --bg-glass: rgba(122, 42, 255, 0.1);
            
            /* Cores de texto */
            --text-primary: #ffffff;
            --text-secondary: #a8b2c9;
            --text-muted: #6c7289;
        }
        
        /* Layout principal CORRIGIDO */
        .game-management-container {
            display: flex;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--steam-dark) 100%);
            padding-top: var(--header-height);
        }
        
        /* Sidebar fixa */
        #sidebar-container {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--steam-dark) 0%, var(--steam-blue) 100%);
            border-right: 1px solid rgba(122, 42, 255, 0.3);
            position: fixed;
            top: var(--header-height);
            left: 0;
            height: calc(100vh - var(--header-height));
            overflow-y: auto;
            z-index: 900;
            transition: transform var(--transition-smooth);
        }
        
        /* Conte√∫do principal CORRIGIDO */
        .main-content-games {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 30px;
            min-height: calc(100vh - var(--header-height));
            background: rgba(10, 8, 20, 0.6);
            backdrop-filter: blur(10px);
            transition: margin-left var(--transition-smooth);
        }
        
        /* Header fixo */
        #header-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            height: var(--header-height);
            background: linear-gradient(90deg, var(--steam-dark) 0%, var(--steam-blue) 100%);
            border-bottom: 1px solid rgba(122, 42, 255, 0.3);
        }
        
        /* Bot√£o mobile toggle */
        .mobile-menu-toggle {
            position: fixed;
            top: calc(var(--header-height) + 20px);
            left: 20px;
            z-index: 999;
            background: linear-gradient(135deg, var(--primary-purple) 0%, var(--steam-accent) 100%);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 0 25px rgba(122, 42, 255, 0.6);
            display: none;
            transition: all var(--transition-smooth);
        }
        
        .mobile-menu-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(122, 42, 255, 0.8);
        }
        
        /* Se√ß√µes do conte√∫do CORRIGIDAS */
        .games-section {
            margin-bottom: 40px;
            animation: fadeIn 0.5s ease forwards;
        }
        
        .section-title {
            display: flex;
            align-items: center;
            gap: 15px;
            font-family: 'Orbitron', sans-serif;
            font-size: 28px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary-purple) 0%, var(--steam-accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 25px;
            text-shadow: 0 0 20px rgba(122, 42, 255, 0.3);
        }
        
        .section-title i {
            font-size: 24px;
            color: var(--steam-accent);
            filter: drop-shadow(0 0 10px rgba(102, 192, 244, 0.5));
        }
        
        /* Card de estat√≠sticas CORRIGIDO */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(145deg, rgba(23, 26, 33, 0.95), rgba(42, 71, 94, 0.95));
            border: 1px solid rgba(102, 192, 244, 0.3);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            transition: all var(--transition-smooth);
            backdrop-filter: blur(10px);
            overflow: hidden;
            position: relative;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-purple), var(--steam-accent));
        }
        
        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            border-color: var(--steam-accent);
            box-shadow: 0 15px 40px rgba(102, 192, 244, 0.3);
        }
        
        .stat-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary-purple) 0%, var(--steam-accent) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: white;
            box-shadow: 0 5px 15px rgba(122, 42, 255, 0.4);
        }
        
        .stat-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--steam-text);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 36px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--neon-cyan) 0%, var(--steam-green) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
            text-shadow: 0 0 15px rgba(0, 243, 255, 0.3);
        }
        
        .stat-label {
            font-size: 14px;
            color: rgba(199, 213, 224, 0.7);
            font-weight: 500;
        }
        
        /* Barra de a√ß√µes CORRIGIDA */
        .action-bar {
            background: rgba(23, 26, 33, 0.9);
            border: 1px solid rgba(102, 192, 244, 0.3);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: space-between;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .btn-action-primary {
            background: linear-gradient(135deg, var(--primary-purple) 0%, var(--steam-accent) 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all var(--transition-smooth);
            box-shadow: 0 5px 15px rgba(122, 42, 255, 0.3);
        }
        
        .btn-action-primary:hover:not(:disabled) {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 10px 25px rgba(102, 192, 244, 0.4);
        }
        
        .btn-action-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn-action-secondary {
            background: rgba(102, 192, 244, 0.15);
            color: var(--steam-text);
            border: 1px solid rgba(102, 192, 244, 0.3);
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all var(--transition-smooth);
        }
        
        .btn-action-secondary:hover:not(:disabled) {
            background: rgba(102, 192, 244, 0.25);
            color: white;
            border-color: var(--steam-accent);
            transform: translateY(-2px);
        }
        
        .btn-action-secondary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn-action-danger {
            background: linear-gradient(135deg, var(--neon-pink) 0%, var(--steam-orange) 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all var(--transition-smooth);
            box-shadow: 0 5px 15px rgba(255, 42, 109, 0.3);
        }
        
        .btn-action-danger:hover:not(:disabled) {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 10px 25px rgba(255, 42, 109, 0.4);
        }
        
        .btn-action-danger:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* Controles de sele√ß√£o CORRIGIDOS */
        .selection-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .select-all-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 6px;
            transition: background var(--transition-smooth);
        }
        
        .select-all-checkbox:hover {
            background: rgba(102, 192, 244, 0.1);
        }
        
        .select-all-checkbox input {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--steam-accent);
        }
        
        .select-all-label {
            color: var(--steam-text);
            font-size: 14px;
            font-weight: 500;
        }
        
        /* Tabela de jogos CORRIGIDA */
        .games-table-container {
            background: rgba(23, 26, 33, 0.9);
            border: 1px solid rgba(102, 192, 244, 0.3);
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 30px;
            max-height: 600px;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .games-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        .games-table thead {
            background: linear-gradient(90deg, rgba(102, 192, 244, 0.2), rgba(122, 42, 255, 0.15));
            position: sticky;
            top: 0;
            z-index: 10;
            backdrop-filter: blur(10px);
        }
        
        .games-table th {
            padding: 20px 15px;
            text-align: left;
            font-weight: 700;
            color: var(--steam-text);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid rgba(102, 192, 244, 0.3);
            white-space: nowrap;
        }
        
        .games-table tbody tr {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all var(--transition-smooth);
        }
        
        .games-table tbody tr:hover {
            background: rgba(102, 192, 244, 0.15);
            transform: translateX(5px);
        }
        
        .games-table td {
            padding: 18px 15px;
            color: var(--steam-text);
            vertical-align: middle;
        }
        
        /* C√©lula do jogo CORRIGIDA */
        .game-cell {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .game-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: var(--steam-accent);
        }
        
        .game-cover {
            width: 80px;
            height: 45px;
            border-radius: 8px;
            object-fit: cover;
            background: linear-gradient(135deg, var(--steam-dark) 0%, var(--steam-blue) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
        }
        
        .game-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-smooth);
        }
        
        .game-cover:hover img {
            transform: scale(1.05);
        }
        
        .game-cover-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-purple) 0%, var(--steam-accent) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }
        
        .game-info {
            flex: 1;
            min-width: 0;
        }
        
        .game-name {
            font-weight: 700;
            font-size: 16px;
            color: white;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
        }
        
        .game-appid {
            font-size: 12px;
            color: rgba(199, 213, 224, 0.7);
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 0.5px;
        }
        
        /* C√©lulas de dados CORRIGIDAS */
        .game-size {
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            font-weight: 700;
            color: var(--neon-cyan);
            text-shadow: 0 0 10px rgba(0, 243, 255, 0.3);
        }
        
        .game-date {
            font-size: 14px;
            color: var(--steam-text);
            font-weight: 500;
        }
        
        .game-status {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
        }
        
        .game-status.valid {
            background: rgba(0, 255, 136, 0.2);
            color: var(--success-green);
            border: 1px solid rgba(0, 255, 136, 0.3);
        }
        
        .game-status.cache {
            background: rgba(0, 243, 255, 0.2);
            color: var(--neon-cyan);
            border: 1px solid rgba(0, 243, 255, 0.3);
        }
        
        .game-status.api {
            background: rgba(255, 170, 0, 0.2);
            color: var(--warning-orange);
            border: 1px solid rgba(255, 170, 0, 0.3);
        }
        
        /* A√ß√µes do jogo CORRIGIDAS */
        .game-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-game-action {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            background: rgba(102, 192, 244, 0.15);
            color: var(--steam-text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-smooth);
        }
        
        .btn-game-action:hover:not(:disabled) {
            background: rgba(102, 192, 244, 0.3);
            color: white;
            transform: translateY(-2px) scale(1.1);
            box-shadow: 0 5px 10px rgba(102, 192, 244, 0.2);
        }
        
        .btn-game-action:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn-game-action.backup {
            color: var(--neon-cyan);
            background: rgba(0, 243, 255, 0.15);
        }
        
        .btn-game-action.backup:hover {
            background: rgba(0, 243, 255, 0.3);
            box-shadow: 0 5px 10px rgba(0, 243, 255, 0.2);
        }
        
        .btn-game-action.refresh {
            color: var(--warning-orange);
            background: rgba(255, 170, 0, 0.15);
        }
        
        .btn-game-action.refresh:hover {
            background: rgba(255, 170, 0, 0.3);
            box-shadow: 0 5px 10px rgba(255, 170, 0, 0.2);
        }
        
        .btn-game-action.delete {
            color: var(--neon-pink);
            background: rgba(255, 42, 109, 0.15);
        }
        
        .btn-game-action.delete:hover {
            background: rgba(255, 42, 109, 0.3);
            box-shadow: 0 5px 10px rgba(255, 42, 109, 0.2);
        }
        
        /* Loading e estados vazios CORRIGIDOS */
        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px 20px;
            color: var(--steam-text);
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(102, 192, 244, 0.3);
            border-top-color: var(--steam-accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px 20px;
            text-align: center;
        }
        
        .empty-icon {
            font-size: 60px;
            color: rgba(102, 192, 244, 0.3);
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        .empty-text {
            color: var(--steam-text);
            font-size: 18px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .empty-subtext {
            color: rgba(199, 213, 224, 0.7);
            font-size: 14px;
            max-width: 400px;
            line-height: 1.5;
        }
        
        /* Modais CORRIGIDOS */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 8, 20, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-smooth);
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: linear-gradient(145deg, var(--steam-dark) 0%, var(--steam-blue) 100%);
            border: 1px solid rgba(102, 192, 244, 0.3);
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.5);
            transform: translateY(20px) scale(0.95);
            transition: transform var(--transition-smooth);
            animation: modalAppear 0.3s ease forwards;
        }
        
        @keyframes modalAppear {
            to {
                transform: translateY(0) scale(1);
            }
        }
        
        .modal-overlay.active .modal-content {
            transform: translateY(0) scale(1);
        }
        
        .modal-header {
            padding: 25px 30px;
            border-bottom: 1px solid rgba(102, 192, 244, 0.3);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .modal-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 22px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary-purple) 0%, var(--steam-accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 20px rgba(122, 42, 255, 0.3);
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--steam-text);
            font-size: 20px;
            cursor: pointer;
            transition: all var(--transition-smooth);
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-close:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .modal-text {
            color: var(--steam-text);
            line-height: 1.6;
            margin-bottom: 25px;
            font-size: 15px;
        }
        
        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }
        
        /* Notifica√ß√µes CORRIGIDAS */
        .notification-container {
            position: fixed;
            top: calc(var(--header-height) + 20px);
            right: 20px;
            z-index: 3000;
            max-width: 400px;
            width: 100%;
        }
        
        .notification {
            background: linear-gradient(145deg, var(--steam-dark) 0%, var(--steam-blue) 100%);
            border: 1px solid rgba(102, 192, 244, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transform: translateX(100%);
            animation: slideIn 0.3s forwards;
            backdrop-filter: blur(10px);
        }
        
        @keyframes slideIn {
            to { transform: translateX(0); }
        }
        
        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .notification.success .notification-icon {
            background: rgba(0, 255, 136, 0.2);
            color: var(--success-green);
            border: 1px solid rgba(0, 255, 136, 0.3);
        }
        
        .notification.warning .notification-icon {
            background: rgba(255, 170, 0, 0.2);
            color: var(--warning-orange);
            border: 1px solid rgba(255, 170, 0, 0.3);
        }
        
        .notification.error .notification-icon {
            background: rgba(255, 42, 109, 0.2);
            color: var(--neon-pink);
            border: 1px solid rgba(255, 42, 109, 0.3);
        }
        
        .notification.info .notification-icon {
            background: rgba(102, 192, 244, 0.2);
            color: var(--steam-accent);
            border: 1px solid rgba(102, 192, 244, 0.3);
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 700;
            color: white;
            margin-bottom: 5px;
            font-size: 16px;
        }
        
        .notification-message {
            color: var(--steam-text);
            font-size: 14px;
            line-height: 1.4;
        }
        
        .notification-close {
            background: none;
            border: none;
            color: rgba(199, 213, 224, 0.5);
            cursor: pointer;
            font-size: 14px;
            transition: color var(--transition-smooth);
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .notification-close:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* Responsividade CORRIGIDA */
        @media (max-width: 1200px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 992px) {
            #sidebar-container {
                transform: translateX(-100%);
            }
            
            #sidebar-container.active {
                transform: translateX(0);
            }
            
            .main-content-games {
                margin-left: 0;
                padding: 20px;
                padding-top: calc(var(--header-height) + 20px);
            }
            
            .mobile-menu-toggle {
                display: flex;
            }
            
            .games-table {
                min-width: 1000px;
            }
            
            .games-table-container {
                overflow-x: auto;
            }
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .action-bar {
                flex-direction: column;
                align-items: stretch;
                gap: 20px;
            }
            
            .action-buttons {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .selection-controls {
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .games-table th,
            .games-table td {
                padding: 15px 10px;
            }
            
            .game-cell {
                gap: 10px;
            }
            
            .game-cover {
                width: 60px;
                height: 34px;
            }
            
            .game-name {
                font-size: 14px;
            }
            
            .modal-content {
                width: 95%;
                padding: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .main-content-games {
                padding: 15px;
                padding-top: calc(var(--header-height) + 15px);
            }
            
            .section-title {
                font-size: 24px;
                gap: 10px;
            }
            
            .btn-action-primary,
            .btn-action-secondary,
            .btn-action-danger {
                padding: 10px 20px;
                font-size: 14px;
                width: 100%;
                justify-content: center;
            }
            
            .stat-card {
                padding: 20px;
            }
            
            .stat-value {
                font-size: 30px;
            }
            
            .mobile-menu-toggle {
                top: calc(var(--header-height) + 10px);
                left: 10px;
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
            
            .modal-actions {
                flex-direction: column;
            }
            
            .modal-actions button {
                width: 100%;
            }
        }
        
        /* Anima√ß√µes CORRIGIDAS */
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        /* Scrollbar personalizada */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(23, 26, 33, 0.3);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-purple) 0%, var(--steam-accent) 100%);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #8a4aff 0%, #88d4ff 100%);
        }
        
        /* Estilos adicionais para diagn√≥sticos */
        .debug-info {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            color: #ff6b6b;
        }
        
        .path-info {
            background: rgba(0, 150, 255, 0.1);
            border: 1px solid rgba(0, 150, 255, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: 'Orbitron', sans-serif;
        }
        
        .path-info-title {
            color: #4de0ff;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .path-info-content {
            color: #a8b2c9;
            font-size: 13px;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <!-- Background -->
    <div class="game-management-background"></div>
    
    <!-- Header fixo -->
    <div id="header-container"></div>
    
    <!-- Bot√£o toggle mobile -->
    <div class="mobile-menu-toggle" id="mobileMenuToggle">
        <i class="fas fa-bars"></i>
    </div>
    
    <!-- Container principal -->
    <div class="game-management-container">
        <!-- Sidebar fixa -->
        <div id="sidebar-container"></div>
        
        <!-- Conte√∫do principal -->
        <main class="main-content-games" id="main-content">
            <!-- T√≠tulo da p√°gina CORRIGIDO -->
            <header class="games-section">
                <h1 class="section-title">
                    <i class="fas fa-gamepad"></i>
                    <span>Gerenciador de Jogos .LUA</span>
                </h1>
                <p class="section-subtitle" style="color: #a8b2c9; margin-top: -10px; margin-bottom: 30px;">
                    Gerencie arquivos .lua detectados em <strong>C:\Program Files (x86)\Steam\config\stplug-in\</strong>
                </p>
            </header>
            
            <!-- Informa√ß√µes do caminho (DEBUG) -->
            <section class="games-section" id="pathDebugSection" style="display: none;">
                <div class="path-info">
                    <div class="path-info-title">
                        <i class="fas fa-search-location"></i> Caminho de Detec√ß√£o
                    </div>
                    <div class="path-info-content" id="debugPathInfo">
                        Carregando informa√ß√µes do caminho...
                    </div>
                </div>
            </section>
            
            <!-- Estat√≠sticas -->
            <section class="games-section">
                <div class="stats-grid">
                    <!-- Total de jogos -->
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <i class="fas fa-gamepad"></i>
                            </div>
                            <div>
                                <div class="stat-title">Jogos Detectados</div>
                                <div class="stat-value" id="stat-total-games">0</div>
                                <div class="stat-label">Arquivos .lua v√°lidos</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Espa√ßo total -->
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <i class="fas fa-hdd"></i>
                            </div>
                            <div>
                                <div class="stat-title">Espa√ßo Utilizado</div>
                                <div class="stat-value" id="stat-total-size">0 B</div>
                                <div class="stat-label">Tamanho total dos jogos</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Nomes do cache -->
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <div>
                                <div class="stat-title">Nomes do Cache</div>
                                <div class="stat-value" id="stat-cache-names">0</div>
                                <div class="stat-label">Jogos com nome em cache</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Jogos da API -->
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <i class="fas fa-satellite-dish"></i>
                            </div>
                            <div>
                                <div class="stat-title">Nomes da API</div>
                                <div class="stat-value" id="stat-api-names">0</div>
                                <div class="stat-label">Jogos com nome da Steam API</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Barra de a√ß√µes CORRIGIDA -->
            <section class="games-section">
                <div class="action-bar">
                    <div class="action-buttons">
                        <button class="btn-action-primary" onclick="detectGames(true)" id="btn-detect">
                            <i class="fas fa-search"></i>
                            <span>Detectar Jogos</span>
                        </button>
                        
                        <button class="btn-action-secondary" onclick="detectGames(false)" id="btn-detect-no-names">
                            <i class="fas fa-search"></i>
                            <span>Detectar Sem Nomes</span>
                        </button>
                        
                        <button class="btn-action-secondary" onclick="refreshNames()" id="btn-refresh">
                            <i class="fas fa-sync-alt"></i>
                            <span>Atualizar Nomes</span>
                        </button>
                        
                        <button class="btn-action-primary" onclick="backupSelectedGames()" id="btn-backup" disabled>
                            <i class="fas fa-save"></i>
                            <span>Backup Selecionados</span>
                        </button>
                        
                        <button class="btn-action-danger" onclick="removeSelectedGames()" id="btn-remove" disabled>
                            <i class="fas fa-trash-alt"></i>
                            <span>Remover Selecionados</span>
                        </button>
                    </div>
                    
                    <div class="selection-controls">
                        <label class="select-all-checkbox">
                            <input type="checkbox" id="selectAllGames" onchange="toggleSelectAll()">
                            <span class="select-all-label">Selecionar Todos</span>
                        </label>
                        
                        <span class="selection-count" id="selectedCount" style="color: #a8b2c9; font-size: 14px;">
                            0 selecionados
                        </span>
                    </div>
                </div>
            </section>
            
            <!-- Tabela de jogos -->
            <section class="games-section">
                <div class="games-table-container">
                    <div id="gamesTableLoading" class="loading-state" style="display: none;">
                        <div class="loading-spinner"></div>
                        <p>Detectando jogos .lua em stplug-in...</p>
                        <p style="font-size: 12px; color: #a8b2c9; margin-top: 10px;" id="loadingDetails"></p>
                    </div>
                    
                    <div id="gamesTableEmpty" class="empty-state" style="display: none;">
                        <div class="empty-icon">
                            <i class="fas fa-gamepad"></i>
                        </div>
                        <p class="empty-text">Nenhum jogo .lua detectado</p>
                        <p class="empty-subtext">Clique em "Detectar Jogos" para come√ßar a busca na pasta stplug-in</p>
                        <button class="btn-action-secondary" onclick="debugPathCheck()" style="margin-top: 20px;">
                            <i class="fas fa-bug"></i>
                            <span>Verificar Caminho</span>
                        </button>
                    </div>
                    
                    <table class="games-table" id="gamesTable" style="display: none;">
                        <thead>
                            <tr>
                                <th style="width: 50px;">
                                    <input type="checkbox" id="tableSelectAll" onchange="toggleTableSelectAll()">
                                </th>
                                <th>Jogo</th>
                                <th style="width: 100px;">Tamanho</th>
                                <th style="width: 150px;">Data de Instala√ß√£o</th>
                                <th style="width: 100px;">Status</th>
                                <th style="width: 150px;">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="gamesTableBody">
                            <!-- Jogos ser√£o inseridos aqui via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- Informa√ß√µes do sistema CORRIGIDAS -->
            <section class="games-section">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div>
                            <div class="stat-title">Informa√ß√µes do Sistema</div>
                            <div class="stat-text" style="color: #a8b2c9; margin-top: 10px; font-size: 14px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; align-items: center;">
                                    <span>Caminho do Steam:</span>
                                    <span id="system-steam-path" style="color: #00f3ff; font-family: 'Orbitron', sans-serif; font-size: 12px; text-align: right; max-width: 60%; word-break: break-all;">Carregando...</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span>Caminho stplug-in:</span>
                                    <span id="system-stplugin-path" style="color: #ffaa00; font-family: 'Orbitron', sans-serif; font-size: 12px;">Carregando...</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span>Status Steam:</span>
                                    <span id="system-steam-status" style="color: #ffaa00; font-weight: bold;">Verificando...</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>√öltima verifica√ß√£o:</span>
                                    <span id="system-last-check" style="color: #a8b2c9; font-family: 'Orbitron', sans-serif; font-size: 12px;">--:--:--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end;">
                        <button class="btn-action-secondary" onclick="debugPathCheck()" style="padding: 5px 10px; font-size: 12px;">
                            <i class="fas fa-bug"></i>
                            <span>Debug</span>
                        </button>
                        <button class="btn-action-secondary" onclick="forcePathValidation()" style="padding: 5px 10px; font-size: 12px;">
                            <i class="fas fa-sync-alt"></i>
                            <span>Validar Caminho</span>
                        </button>
                    </div>
                </div>
            </section>
        </main>
    </div>
    
    <!-- Footer fixo -->
    <div id="footer-container"></div>
    
    <!-- Container de notifica√ß√µes -->
    <div class="notification-container" id="notificationContainer"></div>
    
    <!-- Modal de confirma√ß√£o CORRIGIDO -->
    <div class="modal-overlay" id="confirmationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Confirmar A√ß√£o</h3>
                <button class="modal-close" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p class="modal-text" id="modalMessage">
                    Tem certeza que deseja realizar esta a√ß√£o?
                </p>
                <div class="modal-actions">
                    <button class="btn-action-secondary" onclick="closeModal()">
                        <i class="fas fa-times"></i>
                        <span>Cancelar</span>
                    </button>
                    <button class="btn-action-danger" onclick="confirmAction()" id="modalConfirmBtn">
                        <i class="fas fa-check"></i>
                        <span>Confirmar</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de detalhes do jogo CORRIGIDO -->
    <div class="modal-overlay" id="gameDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Detalhes do Jogo</h3>
                <button class="modal-close" onclick="closeGameDetailsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="game-details-content" id="gameDetailsContent">
                    <!-- Conte√∫do ser√° inserido via JavaScript -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de debug de caminho -->
    <div class="modal-overlay" id="debugPathModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-bug"></i> Debug: Verifica√ß√£o de Caminho
                </h3>
                <button class="modal-close" onclick="closeDebugModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="debugContent">
                    <div class="loading-spinner" style="width: 30px; height: 30px; margin: 20px auto;"></div>
                    <p style="text-align: center; color: #a8b2c9;">Verificando caminhos...</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts CORRIGIDOS E INTEGRADOS -->
    <script>
        // ====== VARI√ÅVEIS GLOBAIS CORRIGIDAS ======
        let detectedGames = [];
        let selectedGames = new Set();
        let currentAction = null;
        let currentActionData = null;
        let gameManagerPath = null;
        let isDetecting = false;
        
        // ====== INICIALIZA√á√ÉO CORRIGIDA ======
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéÆ [CORRIGIDO] Inicializando Gerenciador de Jogos...');
            
            // Carregar componentes
            loadFixedComponents();
            
            // Configurar menu mobile
            setupMobileMenu();
            
            // Atualizar status do sistema
            updateSystemInfo();
            
            // Verificar caminho de detec√ß√£o
            setTimeout(() => {
                checkDetectionPath();
            }, 500);
            
            // Configurar eventos
            setupEventListeners();
            
            console.log('‚úÖ [CORRIGIDO] Gerenciador de Jogos inicializado');
        });
        
        function setupEventListeners() {
            // Atualizar status a cada 30 segundos
            setInterval(updateSystemInfo, 30000);
            
            // Verificar se h√° jogos detectados no cache
            const cachedGames = sessionStorage.getItem('detectedGamesCache');
            if (cachedGames) {
                try {
                    detectedGames = JSON.parse(cachedGames);
                    if (detectedGames.length > 0) {
                        updateGamesTable();
                        updateStatisticsFromGames();
                        showNotification('Cache Restaurado', `Carregados ${detectedGames.length} jogos do cache`, 'info');
                    }
                } catch (e) {
                    console.error('Erro ao carregar cache:', e);
                }
            }
        }
        
        // ====== FUN√á√ïES DE UI CORRIGIDAS ======
        
        async function loadFixedComponents() {
            try {
                // Carregar header
                const headerResponse = await fetch('/header.html');
                const headerHTML = await headerResponse.text();
                document.getElementById('header-container').innerHTML = headerHTML;
                
                // Carregar sidebar
                const sidebarResponse = await fetch('/sidebar.html');
                const sidebarHTML = await sidebarResponse.text();
                document.getElementById('sidebar-container').innerHTML = sidebarHTML;
                
                // Inicializar header se dispon√≠vel
                if (window.SGLHeader && typeof window.SGLHeader.ready === 'function') {
                    window.SGLHeader.ready();
                }
                
                console.log('‚úÖ Componentes fixos carregados');
            } catch (error) {
                console.error('Erro ao carregar componentes:', error);
                showNotification('Erro', 'N√£o foi poss√≠vel carregar todos os componentes', 'error');
            }
        }
        
        function setupMobileMenu() {
            const toggle = document.getElementById('mobileMenuToggle');
            const sidebar = document.getElementById('sidebar-container');
            
            if (toggle && sidebar) {
                toggle.addEventListener('click', (e) => {
                    e.stopPropagation();
                    sidebar.classList.toggle('active');
                    toggle.querySelector('i').className = 
                        sidebar.classList.contains('active') ? 'fas fa-times' : 'fas fa-bars';
                    toggle.style.transform = sidebar.classList.contains('active') ? 'rotate(90deg)' : 'rotate(0)';
                });
                
                // Fechar sidebar ao clicar fora
                document.addEventListener('click', (e) => {
                    if (window.innerWidth <= 992 && sidebar && toggle && 
                        !sidebar.contains(e.target) && 
                        !toggle.contains(e.target) && 
                        sidebar.classList.contains('active')) {
                        sidebar.classList.remove('active');
                        toggle.querySelector('i').className = 'fas fa-bars';
                        toggle.style.transform = 'rotate(0)';
                    }
                });
            }
        }
        
        // ====== FUN√á√ïES DE DETEC√á√ÉO DE JOGOS CORRIGIDAS ======
        
        async function detectGames(fetchNames = true) {
            if (isDetecting) {
                showNotification('Aten√ß√£o', 'J√° est√° detectando jogos. Aguarde...', 'warning');
                return;
            }
            
            try {
                isDetecting = true;
                showLoadingState();
                showNotification('Detec√ß√£o Iniciada', 'Procurando jogos .lua na pasta stplug-in...', 'info');
                
                // Obter caminho do Steam primeiro
                const steamPath = await getSteamPath();
                
                if (!steamPath) {
                    showNotification('Erro', 'Caminho do Steam n√£o encontrado!', 'error');
                    hideLoadingState();
                    isDetecting = false;
                    return;
                }
                
                // Atualizar informa√ß√µes de loading
                document.getElementById('loadingDetails').textContent = 
                    `Verificando: ${steamPath}\\config\\stplug-in\\`;
                
                // CORRE√á√ÉO: Usar par√¢metro force_stplugin para garantir caminho correto
                const response = await fetch('/api/games/detect', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        fetch_names: fetchNames,
                        steam_path: steamPath,
                        force_stplugin: true,  // ‚úÖ PAR√ÇMETRO CR√çTICO ADICIONADO
                        detection_method: 'stplugin'  // ‚úÖ ESPECIFICAR M√âTODO CORRETO
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    detectedGames = data.games || [];
                    
                    // Salvar no cache da sess√£o
                    sessionStorage.setItem('detectedGamesCache', JSON.stringify(detectedGames));
                    
                    updateGamesTable();
                    updateStatistics(data);
                    
                    const count = detectedGames.length;
                    let message = '';
                    
                    if (count === 0) {
                        message = 'Nenhum jogo .lua encontrado na pasta stplug-in';
                        showEmptyState();
                    } else {
                        message = `${count} jogo${count !== 1 ? 's' : ''} .lua detectado${count !== 1 ? 's' : ''} em stplug-in`;
                    }
                    
                    showNotification('Detec√ß√£o Conclu√≠da', message, count > 0 ? 'success' : 'warning');
                    
                    // Atualizar informa√ß√µes do sistema
                    updateSystemInfo();
                    
                } else {
                    throw new Error(data.error || 'Erro desconhecido na detec√ß√£o');
                }
                
            } catch (error) {
                console.error('Erro na detec√ß√£o de jogos:', error);
                showNotification('Erro na Detec√ß√£o', error.message || 'Falha ao detectar jogos', 'error');
                showEmptyState();
                
                // Tentar m√©todo alternativo de debug
                setTimeout(debugPathCheck, 1000);
            } finally {
                isDetecting = false;
                hideLoadingState();
            }
        }
        
        async function refreshNames() {
            if (detectedGames.length === 0) {
                showNotification('Aten√ß√£o', 'Nenhum jogo para atualizar. Detecte jogos primeiro.', 'warning');
                return;
            }
            
            try {
                showNotification('Atualizando Nomes', 'Buscando nomes atualizados da Steam API...', 'info');
                
                const steamPath = await getSteamPath();
                if (!steamPath) {
                    throw new Error('Caminho do Steam n√£o encontrado');
                }
                
                let updatedCount = 0;
                let failedCount = 0;
                const promises = [];
                
                for (const game of detectedGames) {
                    if (game.appid !== 'unknown') {
                        promises.push(
                            fetch(`/api/games/refresh/${game.appid}`, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ steam_path: steamPath })
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success && data.game) {
                                    const index = detectedGames.findIndex(g => g.appid === game.appid);
                                    if (index !== -1) {
                                        detectedGames[index] = data.game;
                                        updatedCount++;
                                    }
                                } else {
                                    failedCount++;
                                }
                            })
                            .catch(() => failedCount++)
                        );
                    }
                }
                
                // Esperar todas as promessas
                await Promise.allSettled(promises);
                
                // Atualizar cache
                sessionStorage.setItem('detectedGamesCache', JSON.stringify(detectedGames));
                
                // Atualizar interface
                updateGamesTable();
                updateStatisticsFromGames();
                
                let message = `${updatedCount} jogo${updatedCount !== 1 ? 's' : ''} atualizado${updatedCount !== 1 ? 's' : ''}`;
                if (failedCount > 0) {
                    message += `, ${failedCount} falha${failedCount !== 1 ? 's' : ''}`;
                }
                
                showNotification('Nomes Atualizados', message, updatedCount > 0 ? 'success' : 'warning');
                
            } catch (error) {
                console.error('Erro ao atualizar nomes:', error);
                showNotification('Erro', 'Falha ao atualizar nomes dos jogos', 'error');
            }
        }
        
        // ====== FUN√á√ïES DE ATUALIZA√á√ÉO DA UI CORRIGIDAS ======
        
        function showLoadingState() {
            document.getElementById('gamesTableLoading').style.display = 'flex';
            document.getElementById('gamesTableEmpty').style.display = 'none';
            document.getElementById('gamesTable').style.display = 'none';
            document.getElementById('pathDebugSection').style.display = 'none';
            
            // Desabilitar bot√µes durante detec√ß√£o
            document.getElementById('btn-detect').disabled = true;
            document.getElementById('btn-detect-no-names').disabled = true;
            document.getElementById('btn-refresh').disabled = true;
        }
        
        function hideLoadingState() {
            document.getElementById('gamesTableLoading').style.display = 'none';
            
            // Reabilitar bot√µes
            document.getElementById('btn-detect').disabled = false;
            document.getElementById('btn-detect-no-names').disabled = false;
            document.getElementById('btn-refresh').disabled = false;
        }
        
        function showEmptyState() {
            document.getElementById('gamesTableLoading').style.display = 'none';
            document.getElementById('gamesTableEmpty').style.display = 'flex';
            document.getElementById('gamesTable').style.display = 'none';
            detectedGames = [];
            selectedGames.clear();
            updateSelectionControls();
        }
        
        function updateGamesTable() {
            const tbody = document.getElementById('gamesTableBody');
            tbody.innerHTML = '';
            
            if (detectedGames.length === 0) {
                showEmptyState();
                return;
            }
            
            // Ordenar jogos por nome
            detectedGames.sort((a, b) => {
                const nameA = a.name || `AppID ${a.appid}`;
                const nameB = b.name || `AppID ${b.appid}`;
                return nameA.localeCompare(nameB);
            });
            
            // Criar linhas da tabela
            detectedGames.forEach(game => {
                const row = document.createElement('tr');
                row.className = 'fade-in';
                row.dataset.appid = game.appid;
                
                // Determinar status
                let statusClass = 'valid';
                let statusText = 'V√°lido';
                
                if (game.name_from_cache) {
                    statusClass = 'cache';
                    statusText = 'Cache';
                } else if (game.real_name) {
                    statusClass = 'api';
                    statusText = 'API';
                }
                
                // URL da capa do jogo
                const coverUrl = game.appid !== 'unknown' 
                    ? `https://cdn.akamai.steamstatic.com/steam/apps/${game.appid}/header.jpg`
                    : '';
                
                // Criar c√©lulas
                const checkboxCell = document.createElement('td');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'game-checkbox';
                checkbox.dataset.appid = game.appid;
                checkbox.checked = selectedGames.has(game.appid);
                checkbox.onchange = () => toggleGameSelection(game.appid);
                checkboxCell.appendChild(checkbox);
                
                const gameCell = document.createElement('td');
                const gameDiv = document.createElement('div');
                gameDiv.className = 'game-cell';
                
                const coverDiv = document.createElement('div');
                coverDiv.className = 'game-cover';
                
                if (coverUrl && game.appid !== 'unknown') {
                    const img = document.createElement('img');
                    img.src = coverUrl;
                    img.alt = game.name;
                    img.onerror = function() {
                        this.onerror = null;
                        this.parentElement.innerHTML = '<div class="game-cover-placeholder"><i class="fas fa-gamepad"></i></div>';
                    };
                    coverDiv.appendChild(img);
                } else {
                    coverDiv.innerHTML = '<div class="game-cover-placeholder"><i class="fas fa-gamepad"></i></div>';
                }
                
                const infoDiv = document.createElement('div');
                infoDiv.className = 'game-info';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'game-name';
                nameDiv.title = game.name;
                nameDiv.textContent = game.name || `AppID ${game.appid}`;
                
                const appidDiv = document.createElement('div');
                appidDiv.className = 'game-appid';
                appidDiv.textContent = `AppID: ${game.appid}`;
                
                infoDiv.appendChild(nameDiv);
                infoDiv.appendChild(appidDiv);
                
                gameDiv.appendChild(coverDiv);
                gameDiv.appendChild(infoDiv);
                gameCell.appendChild(gameDiv);
                
                const sizeCell = document.createElement('td');
                sizeCell.className = 'game-size';
                sizeCell.textContent = game.size_formatted || formatFileSize(game.size || 0);
                
                const dateCell = document.createElement('td');
                dateCell.className = 'game-date';
                dateCell.textContent = game.install_date || game.created_date || 'N/A';
                
                const statusCell = document.createElement('td');
                const statusSpan = document.createElement('span');
                statusSpan.className = `game-status ${statusClass}`;
                statusSpan.textContent = statusText;
                statusCell.appendChild(statusSpan);
                
                const actionsCell = document.createElement('td');
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'game-actions';
                
                // Bot√£o de backup
                const backupBtn = document.createElement('button');
                backupBtn.className = 'btn-game-action backup';
                backupBtn.title = 'Fazer Backup';
                backupBtn.onclick = () => backupGame(game.appid);
                backupBtn.innerHTML = '<i class="fas fa-save"></i>';
                actionsDiv.appendChild(backupBtn);
                
                // Bot√£o de atualizar (apenas se tiver AppID)
                if (game.appid !== 'unknown') {
                    const refreshBtn = document.createElement('button');
                    refreshBtn.className = 'btn-game-action refresh';
                    refreshBtn.title = 'Atualizar Nome';
                    refreshBtn.onclick = () => refreshGameName(game.appid);
                    refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i>';
                    actionsDiv.appendChild(refreshBtn);
                }
                
                // Bot√£o de detalhes
                const detailsBtn = document.createElement('button');
                detailsBtn.className = 'btn-game-action';
                detailsBtn.title = 'Ver Detalhes';
                detailsBtn.onclick = () => showGameDetails(game.appid);
                detailsBtn.innerHTML = '<i class="fas fa-info-circle"></i>';
                actionsDiv.appendChild(detailsBtn);
                
                // Bot√£o de remover
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn-game-action delete';
                deleteBtn.title = 'Remover Jogo';
                deleteBtn.onclick = () => removeGame(game.appid);
                deleteBtn.innerHTML = '<i class="fas fa-trash-alt"></i>';
                actionsDiv.appendChild(deleteBtn);
                
                actionsCell.appendChild(actionsDiv);
                
                // Montar a linha
                row.appendChild(checkboxCell);
                row.appendChild(gameCell);
                row.appendChild(sizeCell);
                row.appendChild(dateCell);
                row.appendChild(statusCell);
                row.appendChild(actionsCell);
                
                tbody.appendChild(row);
            });
            
            // Mostrar tabela
            document.getElementById('gamesTableLoading').style.display = 'none';
            document.getElementById('gamesTableEmpty').style.display = 'none';
            document.getElementById('gamesTable').style.display = 'table';
            
            // Atualizar sele√ß√£o
            updateSelectionControls();
        }
        
        function updateStatistics(data) {
            if (data) {
                document.getElementById('stat-total-games').textContent = data.total_games || detectedGames.length;
                document.getElementById('stat-total-size').textContent = data.total_size_formatted || formatFileSize(data.total_size || 0);
                
                // Contar nomes do cache e API
                const cacheCount = detectedGames.filter(g => g.name_from_cache).length;
                const apiCount = detectedGames.filter(g => g.real_name && !g.name_from_cache).length;
                
                document.getElementById('stat-cache-names').textContent = cacheCount;
                document.getElementById('stat-api-names').textContent = apiCount;
            } else {
                updateStatisticsFromGames();
            }
            
            // Atualizar hora da √∫ltima verifica√ß√£o
            const now = new Date();
            document.getElementById('system-last-check').textContent = 
                `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
        }
        
        function updateStatisticsFromGames() {
            const totalGames = detectedGames.length;
            const totalSize = detectedGames.reduce((sum, game) => sum + (game.size || 0), 0);
            const cacheCount = detectedGames.filter(g => g.name_from_cache).length;
            const apiCount = detectedGames.filter(g => g.real_name && !g.name_from_cache).length;
            
            document.getElementById('stat-total-games').textContent = totalGames;
            document.getElementById('stat-total-size').textContent = formatFileSize(totalSize);
            document.getElementById('stat-cache-names').textContent = cacheCount;
            document.getElementById('stat-api-names').textContent = apiCount;
        }
        
        async function updateSystemInfo() {
            try {
                // Obter informa√ß√µes do sistema Steam
                const response = await fetch('/api/steam/system/status');
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                
                if (data.success && data.system) {
                    const steam = data.system.steam;
                    const steamStatus = steam.running ? 'Online' : 'Offline';
                    const steamStatusColor = steam.running ? '#00ff88' : '#ff2a6d';
                    
                    document.getElementById('system-steam-status').textContent = steamStatus;
                    document.getElementById('system-steam-status').style.color = steamStatusColor;
                    document.getElementById('system-steam-path').textContent = steam.path || 'N√£o detectado';
                    
                    // Calcular caminho stplug-in
                    if (steam.path) {
                        const stpluginPath = `${steam.path}\\config\\stplug-in\\`;
                        document.getElementById('system-stplugin-path').textContent = stpluginPath;
                    }
                }
            } catch (error) {
                console.error('Erro ao atualizar informa√ß√µes do sistema:', error);
                document.getElementById('system-steam-status').textContent = 'Erro';
                document.getElementById('system-steam-status').style.color = '#ff2a6d';
            }
        }
        
        // ====== FUN√á√ïES DE DIAGN√ìSTICO CORRIGIDAS ======
        
        async function checkDetectionPath() {
            try {
                const response = await fetch('/api/games/validate-path', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ check_stplugin: true })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.validation) {
                        const validation = data.validation;
                        
                        if (!validation.has_stplugin_dir) {
                            showNotification('Caminho Inv√°lido', 
                                'Pasta stplug-in n√£o encontrada! Os jogos .lua devem estar em Steam/config/stplug-in/', 
                                'warning');
                        } else if (validation.lua_files_count === 0) {
                            showNotification('Nenhum Jogo', 
                                'Pasta stplug-in encontrada, mas nenhum arquivo .lua detectado', 
                                'info');
                        }
                    }
                }
            } catch (error) {
                console.error('Erro ao verificar caminho:', error);
            }
        }
        
        async function debugPathCheck() {
            try {
                // Abrir modal de debug
                document.getElementById('debugPathModal').classList.add('active');
                
                const steamPath = await getSteamPath();
                if (!steamPath) {
                    document.getElementById('debugContent').innerHTML = `
                        <div style="color: #ff6b6b; text-align: center; padding: 20px;">
                            <i class="fas fa-exclamation-triangle fa-3x" style="margin-bottom: 15px;"></i>
                            <h4>Erro: Caminho do Steam n√£o encontrado</h4>
                            <p>O sistema n√£o conseguiu detectar a instala√ß√£o do Steam.</p>
                        </div>
                    `;
                    return;
                }
                
                const stpluginPath = `${steamPath}\\config\\stplug-in\\`;
                
                // Verificar via API
                const response = await fetch('/api/games/debug-path');
                let debugInfo = '';
                
                if (response.ok) {
                    const data = await response.json();
                    debugInfo = `
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                            <h4 style="color: #4de0ff; margin-bottom: 10px;">Informa√ß√µes da API:</h4>
                            <pre style="color: #a8b2c9; font-size: 12px; overflow: auto; max-height: 200px;">${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
                
                document.getElementById('debugContent').innerHTML = `
                    <div style="color: #a8b2c9;">
                        <h4 style="color: #4de0ff; margin-bottom: 15px;">
                            <i class="fas fa-search-location"></i> An√°lise de Caminhos
                        </h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <div style="background: rgba(0,150,255,0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(0,150,255,0.3);">
                                <div style="font-weight: bold; color: #4de0ff; margin-bottom: 5px;">Steam Path</div>
                                <div style="font-family: monospace; font-size: 12px; word-break: break-all;">${steamPath}</div>
                                <div style="margin-top: 8px; font-size: 12px;">
                                    <span style="color: ${steamPath ? '#00ff88' : '#ff6b6b'}">
                                        <i class="fas fa-${steamPath ? 'check-circle' : 'times-circle'}"></i>
                                        ${steamPath ? 'Encontrado' : 'N√£o encontrado'}
                                    </span>
                                </div>
                            </div>
                            
                            <div style="background: rgba(255,170,0,0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(255,170,0,0.3);">
                                <div style="font-weight: bold; color: #ffaa00; margin-bottom: 5px;">stplug-in Path</div>
                                <div style="font-family: monospace; font-size: 12px; word-break: break-all;">${stpluginPath}</div>
                                <div style="margin-top: 8px; font-size: 12px;">
                                    <span style="color: #ffaa00">
                                        <i class="fas fa-folder"></i>
                                        Caminho calculado
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: rgba(122,42,255,0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(122,42,255,0.3); margin-bottom: 20px;">
                            <h5 style="color: #7a2aff; margin-bottom: 10px;">
                                <i class="fas fa-lightbulb"></i> Informa√ß√£o Importante
                            </h5>
                            <p style="font-size: 14px; line-height: 1.5;">
                                Os jogos .lua devem estar localizados em: 
                                <strong style="color: #00f3ff">C:\\Program Files (x86)\\Steam\\config\\stplug-in\\</strong>
                            </p>
                            <p style="font-size: 13px; color: #a8b2c9; margin-top: 10px;">
                                Este sistema detecta APENAS arquivos .lua nessa pasta espec√≠fica.
                            </p>
                        </div>
                        
                        ${debugInfo}
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="btn-action-primary" onclick="testStpluginPath()">
                                <i class="fas fa-vial"></i>
                                Testar Caminho
                            </button>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Erro no debug:', error);
                document.getElementById('debugContent').innerHTML = `
                    <div style="color: #ff6b6b; text-align: center; padding: 20px;">
                        <i class="fas fa-exclamation-triangle fa-3x" style="margin-bottom: 15px;"></i>
                        <h4>Erro no Debug</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function testStpluginPath() {
            try {
                const steamPath = await getSteamPath();
                if (!steamPath) return;
                
                const response = await fetch('/api/games/validate-path', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        steam_path: steamPath,
                        check_stplugin: true 
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    let resultHtml = `
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; margin-top: 15px;">
                            <h5 style="color: #4de0ff; margin-bottom: 10px;">
                                <i class="fas fa-vial"></i> Resultado do Teste
                            </h5>
                    `;
                    
                    if (data.success && data.validation) {
                        const v = data.validation;
                        
                        resultHtml += `
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                                <div>
                                    <div style="font-size: 12px; color: #a8b2c9;">Steam v√°lido:</div>
                                    <div style="color: ${v.valid ? '#00ff88' : '#ff6b6b'}; font-weight: bold;">
                                        <i class="fas fa-${v.valid ? 'check-circle' : 'times-circle'}"></i>
                                        ${v.valid ? 'SIM' : 'N√ÉO'}
                                    </div>
                                </div>
                                <div>
                                    <div style="font-size: 12px; color: #a8b2c9;">Pasta stplug-in:</div>
                                    <div style="color: ${v.has_stplugin_dir ? '#00ff88' : '#ff6b6b'}; font-weight: bold;">
                                        <i class="fas fa-${v.has_stplugin_dir ? 'check-circle' : 'times-circle'}"></i>
                                        ${v.has_stplugin_dir ? 'ENCONTRADA' : 'N√ÉO ENCONTRADA'}
                                    </div>
                                </div>
                                <div>
                                    <div style="font-size: 12px; color: #a8b2c9;">Arquivos .lua:</div>
                                    <div style="color: ${v.lua_files_count > 0 ? '#00ff88' : '#ffaa00'}; font-weight: bold;">
                                        <i class="fas fa-${v.lua_files_count > 0 ? 'check-circle' : 'exclamation-triangle'}"></i>
                                        ${v.lua_files_count} encontrado(s)
                                    </div>
                                </div>
                                <div>
                                    <div style="font-size: 12px; color: #a8b2c9;">Leg√≠vel:</div>
                                    <div style="color: ${v.readable ? '#00ff88' : '#ff6b6b'}; font-weight: bold;">
                                        <i class="fas fa-${v.readable ? 'check-circle' : 'times-circle'}"></i>
                                        ${v.readable ? 'SIM' : 'N√ÉO'}
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        if (!v.has_stplugin_dir) {
                            resultHtml += `
                                <div style="background: rgba(255,42,109,0.1); padding: 10px; border-radius: 6px; margin-top: 10px; border: 1px solid rgba(255,42,109,0.3);">
                                    <p style="color: #ff2a6d; font-size: 13px; margin: 0;">
                                        <i class="fas fa-exclamation-circle"></i>
                                        A pasta <strong>stplug-in</strong> n√£o foi encontrada em: <code>${v.stplugin_path}</code>
                                    </p>
                                </div>
                            `;
                        }
                    }
                    
                    resultHtml += `</div>`;
                    
                    document.getElementById('debugContent').insertAdjacentHTML('beforeend', resultHtml);
                }
            } catch (error) {
                console.error('Erro no teste:', error);
            }
        }
        
        async function forcePathValidation() {
            try {
                showNotification('Validando Caminho', 'Verificando estrutura do Steam...', 'info');
                
                const response = await fetch('/api/games/validate-path');
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.success && data.validation) {
                        const v = data.validation;
                        let message = '';
                        
                        if (v.valid) {
                            if (v.has_stplugin_dir) {
                                message = `‚úÖ Caminho v√°lido! ${v.lua_files_count} arquivo(s) .lua encontrado(s) em stplug-in`;
                            } else {
                                message = '‚ö†Ô∏è Steam v√°lido, mas pasta stplug-in n√£o encontrada';
                            }
                        } else {
                            message = '‚ùå Caminho do Steam inv√°lido';
                        }
                        
                        showNotification('Valida√ß√£o Conclu√≠da', message, v.valid && v.has_stplugin_dir ? 'success' : 'warning');
                    }
                }
            } catch (error) {
                showNotification('Erro na Valida√ß√£o', error.message, 'error');
            }
        }
        
        // ====== FUN√á√ïES DE SELE√á√ÉO CORRIGIDAS ======
        
        function toggleGameSelection(appid) {
            if (selectedGames.has(appid)) {
                selectedGames.delete(appid);
            } else {
                selectedGames.add(appid);
            }
            
            updateSelectionControls();
        }
        
        function toggleSelectAll() {
            const checkbox = document.getElementById('selectAllGames');
            const tableCheckbox = document.getElementById('tableSelectAll');
            
            if (checkbox.checked || tableCheckbox.checked) {
                detectedGames.forEach(game => {
                    selectedGames.add(game.appid);
                });
            } else {
                selectedGames.clear();
            }
            
            document.querySelectorAll('.game-checkbox').forEach(cb => {
                cb.checked = checkbox.checked;
            });
            
            updateSelectionControls();
        }
        
        function toggleTableSelectAll() {
            toggleSelectAll();
        }
        
        function updateSelectionControls() {
            const selectedCount = selectedGames.size;
            const totalCount = detectedGames.length;
            
            document.getElementById('selectedCount').textContent = `${selectedCount} selecionado${selectedCount !== 1 ? 's' : ''}`;
            document.getElementById('btn-backup').disabled = selectedCount === 0;
            document.getElementById('btn-remove').disabled = selectedCount === 0;
            
            const allSelected = selectedCount > 0 && selectedCount === totalCount;
            const someSelected = selectedCount > 0 && selectedCount < totalCount;
            
            document.getElementById('selectAllGames').checked = allSelected;
            document.getElementById('selectAllGames').indeterminate = someSelected;
            document.getElementById('tableSelectAll').checked = allSelected;
            document.getElementById('tableSelectAll').indeterminate = someSelected;
        }
        
        // ====== FUN√á√ïES DE A√á√ÉO EM JOGOS CORRIGIDAS ======
        
        async function backupGame(appid) {
            const game = detectedGames.find(g => g.appid === appid);
            if (!game) return;
            
            showConfirmationModal(
                'Confirmar Backup',
                `Deseja fazer backup do jogo "${game.name || `AppID ${appid}`}" (AppID: ${appid})?`,
                'backup',
                { games: [game] }
            );
        }
        
        async function backupSelectedGames() {
            if (selectedGames.size === 0) return;
            
            const selectedGamesData = detectedGames.filter(g => selectedGames.has(g.appid));
            
            showConfirmationModal(
                'Confirmar Backup em Massa',
                `Deseja fazer backup de ${selectedGames.size} jogo${selectedGames.size !== 1 ? 's' : ''} selecionado${selectedGames.size !== 1 ? 's' : ''}?`,
                'backup',
                { games: selectedGamesData }
            );
        }
        
        async function removeGame(appid) {
            const game = detectedGames.find(g => g.appid === appid);
            if (!game) return;
            
            showConfirmationModal(
                'Confirmar Remo√ß√£o',
                `‚ö†Ô∏è ATEN√á√ÉO: Deseja remover o jogo "${game.name || `AppID ${appid}`}" (AppID: ${appid})?<br><br><small>Um backup autom√°tico ser√° criado antes da remo√ß√£o.</small>`,
                'remove',
                { games: [game] }
            );
        }
        
        async function removeSelectedGames() {
            if (selectedGames.size === 0) return;
            
            const selectedGamesData = detectedGames.filter(g => selectedGames.has(g.appid));
            
            showConfirmationModal(
                'Confirmar Remo√ß√£o em Massa',
                `‚ö†Ô∏è ATEN√á√ÉO: Deseja remover ${selectedGames.size} jogo${selectedGames.size !== 1 ? 's' : ''} selecionado${selectedGames.size !== 1 ? 's' : ''}?<br><br><small>Um backup autom√°tico ser√° criado antes da remo√ß√£o.</small>`,
                'remove',
                { games: selectedGamesData }
            );
        }
        
        async function refreshGameName(appid) {
            if (appid === 'unknown') {
                showNotification('Aviso', 'Este jogo n√£o tem AppID v√°lido para atualizar', 'warning');
                return;
            }
            
            try {
                showNotification('Atualizando', `Buscando nome atualizado para AppID ${appid}...`, 'info');
                
                const steamPath = await getSteamPath();
                if (!steamPath) throw new Error('Steam path n√£o encontrado');
                
                const response = await fetch(`/api/games/refresh/${appid}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ steam_path: steamPath })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    const index = detectedGames.findIndex(g => g.appid === appid);
                    if (index !== -1) {
                        detectedGames[index] = data.game;
                        updateGamesTable();
                        updateStatisticsFromGames();
                    }
                    
                    showNotification('Nome Atualizado', `Jogo atualizado: ${data.game.name}`, 'success');
                } else {
                    throw new Error(data.error || 'Erro ao atualizar nome');
                }
                
            } catch (error) {
                console.error('Erro ao atualizar nome do jogo:', error);
                showNotification('Erro', 'Falha ao atualizar nome do jogo', 'error');
            }
        }
        
        async function showGameDetails(appid) {
            const game = detectedGames.find(g => g.appid === appid);
            if (!game) return;
            
            const modal = document.getElementById('gameDetailsModal');
            const content = document.getElementById('gameDetailsContent');
            
            // Construir conte√∫do dos detalhes
            content.innerHTML = `
                <div style="margin-bottom: 25px;">
                    <h4 style="color: white; margin-bottom: 15px; font-size: 18px;">
                        <i class="fas fa-info-circle"></i> Informa√ß√µes do Jogo
                    </h4>
                    <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 10px; border: 1px solid rgba(102, 192, 244, 0.2);">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <div style="font-size: 12px; color: rgba(168, 178, 201, 0.7); margin-bottom: 5px;">Nome</div>
                                <div style="color: white; font-weight: 700; font-size: 16px;">${escapeHTML(game.name || `AppID ${game.appid}`)}</div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: rgba(168, 178, 201, 0.7); margin-bottom: 5px;">AppID</div>
                                <div style="color: #00f3ff; font-family: 'Orbitron', sans-serif; font-weight: 700; font-size: 16px;">${escapeHTML(game.appid)}</div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <div style="font-size: 12px; color: rgba(168, 178, 201, 0.7); margin-bottom: 5px;">Tamanho</div>
                                <div style="color: #00ff88; font-family: 'Orbitron', sans-serif; font-size: 14px;">${escapeHTML(game.size_formatted || formatFileSize(game.size || 0))}</div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: rgba(168, 178, 201, 0.7); margin-bottom: 5px;">Tipo</div>
                                <div style="color: white; font-size: 14px;">${escapeHTML(game.type || 'lua')}</div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <div style="font-size: 12px; color: rgba(168, 178, 201, 0.7); margin-bottom: 5px;">Instalado em</div>
                                <div style="color: white; font-size: 14px;">${escapeHTML(game.install_date || 'N/A')}</div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: rgba(168, 178, 201, 0.7); margin-bottom: 5px;">Criado em</div>
                                <div style="color: white; font-size: 14px;">${escapeHTML(game.created_date || 'N/A')}</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(122, 42, 255, 0.2);">
                            <div style="font-size: 12px; color: rgba(168, 178, 201, 0.7); margin-bottom: 5px;">Arquivo .lua</div>
                            <div style="color: #a8b2c9; font-family: monospace; font-size: 13px; word-break: break-all; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px;">
                                ${escapeHTML(game.file_path || 'N/A')}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center;">
                    <button class="btn-action-primary" onclick="backupGame('${escapeHTML(appid)}')" style="margin-right: 10px;">
                        <i class="fas fa-save"></i>
                        <span>Fazer Backup</span>
                    </button>
                    ${game.appid !== 'unknown' ? `
                    <button class="btn-action-secondary" onclick="refreshGameName('${escapeHTML(appid)}')">
                        <i class="fas fa-sync-alt"></i>
                        <span>Atualizar Nome</span>
                    </button>
                    ` : ''}
                </div>
            `;
            
            modal.classList.add('active');
        }
        
        function closeGameDetailsModal() {
            document.getElementById('gameDetailsModal').classList.remove('active');
        }
        
        function closeDebugModal() {
            document.getElementById('debugPathModal').classList.remove('active');
        }
        
        // ====== FUN√á√ïES DE MODAL DE CONFIRMA√á√ÉO CORRIGIDAS ======
        
        function showConfirmationModal(title, message, action, data) {
            const modal = document.getElementById('confirmationModal');
            const titleEl = document.getElementById('modalTitle');
            const messageEl = document.getElementById('modalMessage');
            const confirmBtn = document.getElementById('modalConfirmBtn');
            
            titleEl.textContent = title;
            messageEl.innerHTML = message;
            
            if (action === 'remove') {
                confirmBtn.className = 'btn-action-danger';
                confirmBtn.innerHTML = '<i class="fas fa-trash-alt"></i><span>Remover</span>';
            } else {
                confirmBtn.className = 'btn-action-primary';
                confirmBtn.innerHTML = '<i class="fas fa-save"></i><span>Confirmar Backup</span>';
            }
            
            currentAction = action;
            currentActionData = data;
            
            modal.classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('confirmationModal').classList.remove('active');
            currentAction = null;
            currentActionData = null;
        }
        
        async function confirmAction() {
            if (!currentAction || !currentActionData) return;
            
            closeModal();
            
            if (currentAction === 'backup') {
                await performBackup(currentActionData.games);
            } else if (currentAction === 'remove') {
                await performRemoval(currentActionData.games);
            }
        }
        
        async function performBackup(games) {
            try {
                showNotification('Iniciando Backup', `Preparando backup de ${games.length} jogo(s)...`, 'info');
                
                const steamPath = await getSteamPath();
                if (!steamPath) throw new Error('Steam path n√£o encontrado');
                
                const response = await fetch('/api/games/backup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        games: games,
                        steam_path: steamPath,
                        backup_dir: null
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Backup Conclu√≠do', 
                        `${data.success_count || data.removed_count || 0}/${games.length} backup(s) criado(s) com sucesso`, 
                        'success');
                    
                    if (data.failed_count > 0) {
                        setTimeout(() => {
                            showNotification('Backup Parcial', 
                                `${data.failed_count} jogo(s) falharam no backup. Verifique os logs.`, 
                                'warning');
                        }, 1000);
                    }
                } else {
                    throw new Error(data.error || 'Erro no backup');
                }
                
            } catch (error) {
                console.error('Erro no backup:', error);
                showNotification('Erro no Backup', error.message || 'Falha ao fazer backup', 'error');
            }
        }
        
        async function performRemoval(games) {
            try {
                showNotification('Iniciando Remo√ß√£o', `Preparando remo√ß√£o de ${games.length} jogo(s)...`, 'warning');
                
                const steamPath = await getSteamPath();
                if (!steamPath) throw new Error('Steam path n√£o encontrado');
                
                const response = await fetch('/api/games/remove', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        games: games,
                        steam_path: steamPath
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Remo√ß√£o Conclu√≠da', 
                        `${data.removed_count || 0}/${games.length} jogo(s) removido(s) com sucesso`, 
                        'success');
                    
                    // Atualizar lista de jogos
                    games.forEach(game => {
                        const index = detectedGames.findIndex(g => g.appid === game.appid);
                        if (index !== -1) {
                            detectedGames.splice(index, 1);
                            selectedGames.delete(game.appid);
                        }
                    });
                    
                    // Atualizar cache
                    sessionStorage.setItem('detectedGamesCache', JSON.stringify(detectedGames));
                    
                    updateGamesTable();
                    updateStatisticsFromGames();
                    
                    if (data.failed_count > 0) {
                        setTimeout(() => {
                            showNotification('Remo√ß√£o Parcial', 
                                `${data.failed_count} jogo(s) n√£o puderam ser removidos.`, 
                                'warning');
                        }, 1000);
                    }
                } else {
                    throw new Error(data.error || 'Erro na remo√ß√£o');
                }
                
            } catch (error) {
                console.error('Erro na remo√ß√£o:', error);
                showNotification('Erro na Remo√ß√£o', error.message || 'Falha ao remover jogos', 'error');
            }
        }
        
        // ====== FUN√á√ïES UTILIT√ÅRIAS CORRIGIDAS ======
        
        async function getSteamPath() {
            try {
                const response = await fetch('/api/steam/system/status');
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                if (data.success && data.system && data.system.steam) {
                    return data.system.steam.path;
                }
            } catch (error) {
                console.error('Erro ao obter caminho do Steam:', error);
            }
            return null;
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0 || !bytes) return '0 B';
            
            const units = ['B', 'KB', 'MB', 'GB'];
            let unitIndex = 0;
            let size = bytes;
            
            while (size >= 1024 && unitIndex < units.length - 1) {
                size /= 1024;
                unitIndex++;
            }
            
            if (unitIndex === 0) {
                return `${size.toFixed(0)} ${units[unitIndex]}`;
            } else if (size < 10) {
                return `${size.toFixed(1)} ${units[unitIndex]}`;
            } else {
                return `${size.toFixed(0)} ${units[unitIndex]}`;
            }
        }
        
        function escapeHTML(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function showNotification(title, message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            
            // Limitar a 3 notifica√ß√µes
            while (container.children.length >= 3) {
                container.removeChild(container.firstChild);
            }
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            else if (type === 'warning') icon = 'exclamation-triangle';
            else if (type === 'error') icon = 'times-circle';
            
            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="fas fa-${icon}"></i>
                </div>
                <div class="notification-content">
                    <div class="notification-title">${escapeHTML(title)}</div>
                    <div class="notification-message">${escapeHTML(message)}</div>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(notification);
            
            // Auto-remover ap√≥s 5 segundos
            setTimeout(() => {
                if (notification.parentElement) notification.remove();
            }, 5000);
        }
        
        // ====== EXPORTAR FUN√á√ïES PARA O ESCOPO GLOBAL ======
        window.detectGames = detectGames;
        window.refreshNames = refreshNames;
        window.backupSelectedGames = backupSelectedGames;
        window.removeSelectedGames = removeSelectedGames;
        window.toggleGameSelection = toggleGameSelection;
        window.toggleSelectAll = toggleSelectAll;
        window.toggleTableSelectAll = toggleTableSelectAll;
        window.backupGame = backupGame;
        window.removeGame = removeGame;
        window.refreshGameName = refreshGameName;
        window.showGameDetails = showGameDetails;
        window.closeModal = closeModal;
        window.confirmAction = confirmAction;
        window.closeGameDetailsModal = closeGameDetailsModal;
        window.closeDebugModal = closeDebugModal;
        window.debugPathCheck = debugPathCheck;
        window.testStpluginPath = testStpluginPath;
        window.forcePathValidation = forcePathValidation;
        window.showNotification = showNotification;
        window.formatFileSize = formatFileSize;
        
        console.log('‚úÖ [CORRIGIDO] Fun√ß√µes do gerenciador de jogos exportadas');
    </script>
</body>
</html>
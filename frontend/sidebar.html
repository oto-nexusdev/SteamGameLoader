<!-- frontend/sidebar.html - VERS√ÉO FINAL DEFINITIVA CORRIGIDA -->
<div class="home-sidebar" id="homeSidebar">
    <!-- Logo da Home -->
    <div class="sidebar-logo-home">
        <div class="sidebar-logo-icon">
            <i class="fas fa-tools"></i>
        </div>
        <div class="sidebar-logo-text">
            <h1>Navega√ß√£o</h1>
            <span>Steam GameLoader v16.0</span>
        </div>
        <button class="sidebar-close-btn" onclick="closeSidebarMobile()" aria-label="Fechar menu">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <!-- Menu de navega√ß√£o da Home -->
    <nav class="sidebar-nav-home">
        <!-- Se√ß√£o de Navega√ß√£o -->
        <div class="nav-section-home">
            <h3 class="nav-title-home">
                <i class="fas fa-compass"></i>
                <span>Navega√ß√£o</span>
            </h3>
            <ul class="nav-menu-home">
                <li class="nav-item-home">
                    <a href="/" class="nav-link-home" onclick="setActiveLink(this); return navigateTo('app');">
                        <i class="fas fa-home"></i>
                        <span>Home Principal</span>
                        <span class="nav-badge-home star">‚òÖ</span>
                    </a>
                </li>
                <li class="nav-item-home">
                    <a href="/dashboard" class="nav-link-home" onclick="setActiveLink(this);">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                        <span class="nav-badge-home new">NOVO</span>
                    </a>
                </li>
                <li class="nav-item-home">
                    <a href="/search" class="nav-link-home" onclick="setActiveLink(this);">
                        <i class="fas fa-search"></i>
                        <span>Buscar Jogos</span>
                    </a>
                </li>
                <li class="nav-item-home">
                    <a href="/games" class="nav-link-home" onclick="setActiveLink(this);">
                        <i class="fas fa-gamepad"></i>
                        <span>Meus Jogos</span>
                        <span class="nav-badge-home" id="sidebar-games-count">0</span>
                    </a>
                </li>
            </ul>
        </div>
        
        <!-- Se√ß√£o de Ferramentas -->
        <div class="nav-section-home">
            <h3 class="nav-title-home">
                <i class="fas fa-tools"></i>
                <span>Ferramentas</span>
            </h3>
            <ul class="nav-menu-home">
                <li class="nav-item-home">
                    <a href="#" class="nav-link-home" onclick="setActiveLink(this); scanLibrary(); return false;">
                        <i class="fas fa-search-plus"></i>
                        <span>Escanear Biblioteca</span>
                        <span class="nav-badge-home scan">SCAN</span>
                    </a>
                </li>
                <li class="nav-item-home">
                    <a href="/fixes" class="nav-link-home" onclick="setActiveLink(this);">
                        <i class="fas fa-wrench"></i>
                        <span>Fix Manager</span>
                        <span class="nav-badge-home auto">CR√çTICO</span>
                    </a>
                </li>
                <li class="nav-item-home">
                    <a href="/dlc" class="nav-link-home" onclick="setActiveLink(this);">
                        <i class="fas fa-puzzle-piece"></i>
                        <span>DLC Manager</span>
                        <span class="nav-badge-home integrated">PRO</span>
                    </a>
                </li>
                <li class="nav-item-home">
                    <a href="/app" class="nav-link-home" onclick="setActiveLink(this);">
                        <i class="fas fa-rocket"></i>
                        <span>Recarregar Interface</span>
                        <span class="nav-badge-home power">UPDATE</span>
                    </a>
                </li>
            </ul>
        </div>
        
        <!-- Se√ß√£o de Sistema -->
        <div class="nav-section-home">
            <h3 class="nav-title-home">
                <i class="fas fa-server"></i>
                <span>Sistema</span>
            </h3>
            <ul class="nav-menu-home">
                <li class="nav-item-home">
                    <a href="/settings#steam" class="nav-link-home" onclick="setActiveLink(this);">
                        <i class="fab fa-steam"></i>
                        <span>Status Steam</span>
                        <span class="status-dot-home online" id="home-steam-dot"></span>
                    </a>
                </li>
                <li class="nav-item-home">
                    <a href="/settings#system" class="nav-link-home" onclick="setActiveLink(this);">
                        <i class="fas fa-cogs"></i>
                        <span>Status DLL</span>
                        <span class="status-dot-home online" id="home-dll-dot"></span>
                    </a>
                </li>
                <li class="nav-item-home">
                    <a href="/dashboard#settings" class="nav-link-home" onclick="setActiveLink(this);">
                        <i class="fas fa-sliders-h"></i>
                        <span>Configura√ß√µes</span>
                    </a>
                </li>
                <li class="nav-item-home">
                    <a href="/dashboard#logs" class="nav-link-home" onclick="setActiveLink(this);">
                        <i class="fas fa-terminal"></i>
                        <span>Logs do Sistema</span>
                    </a>
                </li>
            </ul>
        </div>
        
        <!-- Se√ß√£o de A√ß√µes R√°pidas -->
        <div class="nav-section-home">
            <h3 class="nav-title-home">
                <i class="fas fa-bolt"></i>
                <span>A√ß√µes R√°pidas</span>
            </h3>
            <ul class="nav-menu-home">
                <li class="nav-item-home">
                    <a href="#" class="nav-link-home action-btn-home" onclick="setActiveLink(this); detectGames(); return false;">
                        <i class="fas fa-bolt"></i>
                        <span>Detectar Jogos</span>
                        <span class="nav-badge-home lightning">‚ö°</span>
                    </a>
                </li>
                <li class="nav-item-home">
                    <a href="#" class="nav-link-home action-btn-home" onclick="setActiveLink(this); clearSystemCache(); return false;">
                        <i class="fas fa-plug"></i>
                        <span>Limpar Cache</span>
                    </a>
                </li>
                <li class="nav-item-home">
                    <a href="#" class="nav-link-home action-btn-home" onclick="setActiveLink(this); runSystemDiagnostic(); return false;">
                        <i class="fas fa-broom"></i>
                        <span>Diagn√≥stico</span>
                    </a>
                </li>
                <li class="nav-item-home">
                    <a href="#" class="nav-link-home action-btn-home" onclick="setActiveLink(this); refreshSidebar(); return false;">
                        <i class="fas fa-sync-alt"></i>
                        <span>Atualizar Tudo</span>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
    
    <!-- Status R√°pido FIXO no rodap√© - FORA DO NAV -->
    <div class="sidebar-footer-home">
        <div class="footer-status-home">
            <div class="status-item-home">
                <span class="status-label-home">Steam</span>
                <span class="status-value-home online" id="footer-steam-status">OK</span>
            </div>
            <div class="status-item-home">
                <span class="status-label-home">DLL</span>
                <span class="status-value-home online" id="footer-dll-status">OK</span>
            </div>
            <div class="status-item-home">
                <span class="status-label-home">Sistema</span>
                <span class="status-value-home online" id="footer-system-status">OK</span>
            </div>
        </div>
    </div>
</div>

<style>
    /* ====== SIDEBAR DA HOME - VERS√ÉO DEFINITIVA SIMPLES ====== */
    :root {
        --sidebar-bg: linear-gradient(180deg, #0a0814 0%, #0f0c1f 100%);
        --sidebar-border: rgba(122, 42, 255, 0.4);
        --primary-gradient: linear-gradient(135deg, #7a2aff 0%, #ff2a6d 100%);
        --secondary-gradient: linear-gradient(135deg, #00f3ff 0%, #00aacc 100%);
        --success-gradient: linear-gradient(135deg, #00ff88 0%, #00cc66 100%);
        --warning-gradient: linear-gradient(135deg, #ffaa00 0%, #ff5500 100%);
        --danger-gradient: linear-gradient(135deg, #ff2a6d 0%, #cc0052 100%);
        --cyan-color: #00f3ff;
        --magenta-color: #ff2a6d;
        --purple-color: #9d4edd;
        --teal-color: #2af7b9;
        --orange-color: #ff8800;
        
        --text-primary: #ffffff;
        --text-secondary: rgba(168, 178, 201, 0.95);
        --text-muted: rgba(108, 114, 137, 0.8);
        --border-light: rgba(255, 255, 255, 0.08);
        
        --header-height: 80px;
        --sidebar-width: 280px;
        --footer-height: 70px; /* Altura fixa do footer */
    }
    
    /* ====== CONTAINER PRINCIPAL SIMPLES ====== */
    .home-sidebar {
        width: var(--sidebar-width);
        background: var(--sidebar-bg);
        border-right: 1px solid var(--sidebar-border);
        display: flex;
        flex-direction: column;
        position: fixed;
        top: var(--header-height);
        left: 0;
        bottom: 0; /* Preenche do topo at√© o fundo */
        z-index: 1000;
        box-sizing: border-box;
        box-shadow: 5px 0 30px rgba(0, 0, 0, 0.5);
    }
    
    /* ====== LOGO SIMPLES ====== */
    .sidebar-logo-home {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 25px 20px;
        border-bottom: 1px solid var(--border-light);
        flex-shrink: 0;
        background: rgba(10, 8, 20, 0.8);
    }
    
    .sidebar-logo-icon {
        width: 50px;
        height: 50px;
        background: var(--primary-gradient);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
        color: var(--text-primary);
        box-shadow: 0 5px 20px rgba(122, 42, 255, 0.4);
        flex-shrink: 0;
    }
    
    .sidebar-logo-text {
        flex: 1;
        min-width: 0;
    }
    
    .sidebar-logo-text h1 {
        font-family: 'Orbitron', sans-serif;
        font-size: 20px;
        font-weight: 900;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        line-height: 1.2;
        margin: 0 0 4px 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .sidebar-logo-text span {
        font-size: 11px;
        color: var(--cyan-color);
        font-weight: 600;
        letter-spacing: 1px;
        display: block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .sidebar-close-btn {
        display: none;
        background: rgba(122, 42, 255, 0.2);
        border: 1px solid rgba(122, 42, 255, 0.4);
        color: var(--text-primary);
        width: 32px;
        height: 32px;
        border-radius: 8px;
        cursor: pointer;
        align-items: center;
        justify-content: center;
        font-size: 14px;
    }
    
    .sidebar-close-btn:hover {
        background: rgba(122, 42, 255, 0.4);
        border-color: #7a2aff;
    }
    
    /* ====== NAVEGA√á√ÉO COM SCROLL INTERNO ====== */
    .sidebar-nav-home {
        flex: 1; /* Ocupa todo espa√ßo dispon√≠vel */
        display: flex;
        flex-direction: column;
        padding: 20px;
        overflow-y: auto; /* Scroll interno APENAS se necess√°rio */
        overflow-x: hidden;
        min-height: 0; /* Importante para flex funcionar */
    }
    
    /* Esconde scrollbar mas mant√©m funcionalidade */
    .sidebar-nav-home::-webkit-scrollbar {
        width: 4px;
    }
    
    .sidebar-nav-home::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.1);
    }
    
    .sidebar-nav-home::-webkit-scrollbar-thumb {
        background: rgba(122, 42, 255, 0.4);
        border-radius: 2px;
    }
    
    .sidebar-nav-home::-webkit-scrollbar-thumb:hover {
        background: rgba(122, 42, 255, 0.6);
    }
    
    /* Para Firefox */
    .sidebar-nav-home {
        scrollbar-width: thin;
        scrollbar-color: rgba(122, 42, 255, 0.4) rgba(0, 0, 0, 0.1);
    }
    
    /* ====== SE√á√ïES ====== */
    .nav-section-home {
        margin-bottom: 25px;
        width: 100%;
    }
    
    .nav-title-home {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 12px;
        color: var(--cyan-color);
        text-transform: uppercase;
        letter-spacing: 1px;
        margin: 0 0 15px 0;
        font-weight: 700;
        padding-left: 5px;
    }
    
    .nav-title-home i {
        font-size: 12px;
        color: var(--cyan-color);
    }
    
    .nav-menu-home {
        list-style: none;
        padding: 0;
        margin: 0;
        width: 100%;
    }
    
    .nav-item-home {
        margin-bottom: 8px;
        width: 100%;
    }
    
    .nav-link-home {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 14px 16px;
        color: var(--text-secondary);
        text-decoration: none;
        border-radius: 10px;
        transition: all 0.2s ease;
        font-weight: 500;
        font-size: 14px;
        background: rgba(20, 18, 35, 0.4);
        border: 1px solid transparent;
        cursor: pointer;
        width: 100%;
        box-sizing: border-box;
    }
    
    .nav-link-home:hover {
        background: rgba(122, 42, 255, 0.12);
        color: var(--text-primary);
        border-color: rgba(122, 42, 255, 0.3);
    }
    
    .nav-link-home.active {
        background: linear-gradient(90deg, 
            rgba(122, 42, 255, 0.2), 
            rgba(255, 42, 109, 0.1));
        color: var(--text-primary);
        font-weight: 700;
        border-left: 3px solid var(--cyan-color);
    }
    
    .nav-link-home i {
        width: 20px;
        text-align: center;
        font-size: 16px;
        color: inherit;
    }
    
    /* ====== BADGES ====== */
    .nav-badge-home {
        margin-left: auto;
        font-size: 10px;
        padding: 4px 10px;
        border-radius: 10px;
        font-weight: 900;
        min-width: 26px;
        text-align: center;
        letter-spacing: 0.3px;
        flex-shrink: 0;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        white-space: nowrap;
        box-sizing: border-box;
    }
    
    .nav-badge-home.star {
        background: linear-gradient(135deg, #ffcc00 0%, #ff8800 100%);
        color: #0b0610;
    }
    
    .nav-badge-home.new {
        background: linear-gradient(135deg, var(--cyan-color) 0%, #00aacc 100%);
        color: #0b0610;
    }
    
    .nav-badge-home.scan {
        background: linear-gradient(135deg, var(--teal-color) 0%, #00cc88 100%);
        color: #0b0610;
    }
    
    .nav-badge-home.auto {
        background: linear-gradient(135deg, var(--magenta-color) 0%, #cc0052 100%);
        color: white;
    }
    
    .nav-badge-home.integrated {
        background: linear-gradient(135deg, var(--purple-color) 0%, #7a2aff 100%);
        color: white;
    }
    
    .nav-badge-home.power {
        background: linear-gradient(135deg, #bb33ff 0%, #8800cc 100%);
        color: white;
    }
    
    .nav-badge-home.lightning {
        background: linear-gradient(135deg, #ffcc00 0%, #ff8800 100%);
        color: #0b0610;
        padding: 4px 8px;
        font-size: 12px;
        min-width: 24px;
    }
    
    /* ====== STATUS DOTS ====== */
    .status-dot-home {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-left: auto;
        box-shadow: 0 0 8px currentColor;
        flex-shrink: 0;
    }
    
    .status-dot-home.online {
        background: #00ff88;
        color: #00ff88;
    }
    
    .status-dot-home.warning {
        background: #ffaa00;
        color: #ffaa00;
    }
    
    .status-dot-home.offline {
        background: #ff2a6d;
        color: #ff2a6d;
    }
    
    /* ====== FOOTER FIXO ====== */
    .sidebar-footer-home {
        padding: 15px 20px;
        border-top: 1px solid var(--border-light);
        flex-shrink: 0; /* N√£o encolhe */
        background: rgba(15, 12, 31, 0.9);
        backdrop-filter: blur(10px);
    }
    
    .footer-status-home {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
    }
    
    .status-item-home {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 8px 5px;
        background: rgba(20, 18, 35, 0.6);
        border-radius: 8px;
        border: 1px solid rgba(122, 42, 255, 0.1);
    }
    
    .status-label-home {
        font-size: 9px;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 3px;
        white-space: nowrap;
    }
    
    .status-value-home {
        font-family: 'Orbitron', sans-serif;
        font-size: 11px;
        font-weight: 700;
        color: #00ff88;
        white-space: nowrap;
    }
    
    .status-value-home.online {
        color: #00ff88;
    }
    
    .status-value-home.warning {
        color: #ffaa00;
    }
    
    .status-value-home.offline {
        color: #ff2a6d;
    }
    
    /* ====== RESPONSIVIDADE ====== */
    @media (max-width: 1200px) {
        .home-sidebar {
            width: 260px;
        }
    }
    
    @media (max-width: 992px) {
        .home-sidebar {
            position: fixed;
            left: -280px;
            top: var(--header-height);
            bottom: 0;
            height: auto;
            transition: left 0.3s ease;
            z-index: 1000;
        }
        
        .home-sidebar.active {
            left: 0;
        }
        
        .sidebar-close-btn {
            display: flex;
        }
    }
    
    @media (max-width: 768px) {
        .home-sidebar {
            width: 260px;
        }
        
        .sidebar-logo-home {
            padding: 20px 15px;
        }
        
        .sidebar-nav-home {
            padding: 15px;
        }
        
        .nav-link-home {
            padding: 12px 14px;
            font-size: 13px;
        }
        
        .sidebar-footer-home {
            padding: 12px 15px;
        }
    }
    
    @media (max-width: 576px) {
        .home-sidebar {
            width: 240px;
        }
        
        .sidebar-logo-home {
            flex-direction: column;
            text-align: center;
            gap: 10px;
        }
        
        .nav-link-home {
            padding: 11px 12px;
        }
        
        .footer-status-home {
            gap: 8px;
        }
    }
</style>

<script>
    // ====== SIDEBAR SIMPLES E FUNCIONAL ======
    
    // Estado da sidebar
    const sidebarState = {
        gamesCount: 0,
        steamStatus: 'online',
        dllStatus: 'online',
        systemStatus: 'online',
        isInitialized: false
    };
    
    // Inicializa√ß√£o
    function initializeSidebar() {
        if (sidebarState.isInitialized) return;
        
        console.log('üîß Inicializando sidebar...');
        
        // Configurar altura corretamente
        setupSidebarHeight();
        
        // Configurar links ativos
        setupActiveLinks();
        
        // Configurar eventos
        setupSidebarEvents();
        
        // Carregar dados
        loadSidebarData();
        
        sidebarState.isInitialized = true;
        console.log('‚úÖ Sidebar inicializada');
    }
    
    // Configurar altura da sidebar
    function setupSidebarHeight() {
        // A sidebar j√° usa bottom: 0 para preencher toda a altura
        // Apenas garantimos que o header n√£o interfira
        const header = document.querySelector('#header-container');
        if (header) {
            const headerHeight = header.offsetHeight;
            document.documentElement.style.setProperty('--header-height', `${headerHeight}px`);
            
            // Ajustar top da sidebar
            const sidebar = document.getElementById('homeSidebar');
            if (sidebar) {
                sidebar.style.top = `${headerHeight}px`;
            }
        }
    }
    
    // Configurar eventos
    function setupSidebarEvents() {
        // Fechar sidebar ao clicar fora (mobile)
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 992) {
                const sidebar = document.getElementById('homeSidebar');
                const toggle = document.querySelector('.mobile-menu-toggle');
                
                if (sidebar && 
                    sidebar.classList.contains('active') &&
                    !sidebar.contains(event.target) &&
                    !event.target.closest('.mobile-menu-toggle')) {
                    closeSidebarMobile();
                }
            }
        });
        
        // Redimensionamento
        window.addEventListener('resize', function() {
            setupSidebarHeight();
            
            // Fechar sidebar se mudar para desktop
            if (window.innerWidth > 992) {
                const sidebar = document.getElementById('homeSidebar');
                if (sidebar) sidebar.classList.add('active');
            }
        });
    }
    
    // Carregar dados
    async function loadSidebarData() {
        try {
            // Contagem de jogos
            const gamesResponse = await fetch('/api/games/count');
            if (gamesResponse.ok) {
                const gamesData = await gamesResponse.json();
                sidebarState.gamesCount = gamesData.count || 0;
                updateGamesCountDisplay();
            }
            
            // Status Steam/DLL
            const steamResponse = await fetch('/api/steam/user/full-info');
            if (steamResponse.ok) {
                const steamData = await steamResponse.json();
                if (steamData.success && steamData.user) {
                    const user = steamData.user;
                    
                    // Steam
                    const steamStatus = user.steam_running ? 'online' : 'offline';
                    updateStatusElement('footer-steam-status', steamStatus);
                    updateStatusElement('home-steam-dot', steamStatus);
                    
                    // DLL
                    const dllStatus = user.dll_available ? 'online' : 'warning';
                    updateStatusElement('footer-dll-status', dllStatus);
                    updateStatusElement('home-dll-dot', dllStatus);
                }
            }
            
            // Status do sistema
            const systemResponse = await fetch('/api/system/status');
            if (systemResponse.ok) {
                const systemData = await systemResponse.json();
                sidebarState.systemStatus = systemData.status || 'online';
                updateSystemStatusDisplay();
            }
            
        } catch (error) {
            console.warn('Erro ao carregar dados da sidebar:', error);
        }
    }
    
    // Fun√ß√µes auxiliares
    function updateStatusElement(elementId, status) {
        const element = document.getElementById(elementId);
        if (!element) return;
        
        element.className = element.className.replace(/\b(online|warning|offline)\b/g, '') + ' ' + status;
        
        if (elementId.includes('footer')) {
            element.textContent = status === 'online' ? 'OK' : 
                                 status === 'warning' ? 'AVISO' : 'OFF';
        }
    }
    
    function updateGamesCountDisplay() {
        const element = document.getElementById('sidebar-games-count');
        if (element) {
            element.textContent = sidebarState.gamesCount;
        }
    }
    
    function updateSystemStatusDisplay() {
        const element = document.getElementById('footer-system-status');
        if (!element) return;
        
        element.textContent = sidebarState.systemStatus === 'online' ? 'OK' : 
                             sidebarState.systemStatus === 'warning' ? 'AVISO' : 'ERR';
        
        element.className = 'status-value-home ' + sidebarState.systemStatus;
    }
    
    // Fun√ß√µes de navega√ß√£o
    window.setActiveLink = function(clickedLink) {
        // Remover active de todos
        document.querySelectorAll('.nav-link-home').forEach(link => {
            link.classList.remove('active');
        });
        
        // Adicionar ao clicado
        if (clickedLink) {
            clickedLink.classList.add('active');
        }
        
        // Fechar no mobile
        if (window.innerWidth <= 992) {
            closeSidebarMobile();
        }
        
        return true;
    };
    
    window.navigateTo = function(destination) {
        const routes = {
            'dlc': '/dlc',
            'fixes': '/fixes',
            'games': '/games',
            'search': '/search',
            'settings': '/dashboard#settings',
            'logs': '/dashboard#logs',
            'dashboard': '/dashboard',
            'app': '/'
        };
        
        const route = routes[destination] || '/';
        window.location.href = route;
        return false;
    };
    
    // Configurar links ativos
    function setupActiveLinks() {
        const currentPath = window.location.pathname;
        const hash = window.location.hash;
        
        document.querySelectorAll('.nav-link-home').forEach(link => {
            link.classList.remove('active');
            
            const href = link.getAttribute('href');
            if (!href || href === '#') return;
            
            const linkPath = href.split('#')[0];
            const currentPathClean = currentPath.split('#')[0];
            
            if (linkPath === currentPathClean || 
                (hash && href.includes(hash)) ||
                (currentPath.includes('/games') && href.includes('/games')) ||
                (currentPath.includes('/dashboard') && href.includes('/dashboard')) ||
                (currentPath === '/' && href === '/')) {
                link.classList.add('active');
            }
        });
    }
    
    // Fun√ß√µes de a√ß√£o
    window.refreshSidebar = async function() {
        await loadSidebarData();
        if (typeof showNotification === 'function') {
            showNotification('Sidebar', 'Dados atualizados', 'success');
        }
    };
    
    window.detectGames = async function() {
        try {
            const response = await fetch('/api/games/detect', { method: 'POST' });
            if (response.ok) {
                const data = await response.json();
                sidebarState.gamesCount = data.count || 0;
                updateGamesCountDisplay();
                
                if (typeof showNotification === 'function') {
                    showNotification('Jogos', `Encontrados ${data.count} jogos`, 'success');
                }
                
                setTimeout(() => navigateTo('games'), 1000);
            }
        } catch (error) {
            console.error('Erro ao detectar jogos:', error);
        }
    };
    
    window.clearSystemCache = async function() {
        try {
            await fetch('/api/system/clear-cache', { method: 'POST' });
            if (typeof showNotification === 'function') {
                showNotification('Cache', 'Cache limpo', 'success');
            }
        } catch (error) {
            console.error('Erro ao limpar cache:', error);
        }
    };
    
    window.runSystemDiagnostic = async function() {
        try {
            const response = await fetch('/api/system/diagnostic');
            if (response.ok) {
                const data = await response.json();
                sidebarState.systemStatus = data.status || 'online';
                updateSystemStatusDisplay();
                
                if (typeof showNotification === 'function') {
                    showNotification('Diagn√≥stico', `Status: ${data.status}`, 
                        data.status === 'healthy' ? 'success' : 'warning');
                }
            }
        } catch (error) {
            console.error('Erro no diagn√≥stico:', error);
        }
    };
    
    window.scanLibrary = function() {
        detectGames();
    };
    
    // Fun√ß√µes mobile
    window.closeSidebarMobile = function() {
        const sidebar = document.getElementById('homeSidebar');
        const toggle = document.querySelector('.mobile-menu-toggle');
        
        if (sidebar) sidebar.classList.remove('active');
        if (toggle) toggle.querySelector('i').className = 'fas fa-bars';
    };
    
    window.openSidebarMobile = function() {
        const sidebar = document.getElementById('homeSidebar');
        if (sidebar) sidebar.classList.add('active');
    };
    
    window.toggleSidebarMobile = function() {
        const sidebar = document.getElementById('homeSidebar');
        if (sidebar) {
            sidebar.classList.toggle('active');
            const icon = document.querySelector('.mobile-menu-toggle i');
            if (icon) {
                icon.className = sidebar.classList.contains('active') ? 'fas fa-times' : 'fas fa-bars';
            }
        }
    };
    
    // Inicializar
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeSidebar);
    } else {
        setTimeout(initializeSidebar, 100);
    }
    
    // Atualiza√ß√µes peri√≥dicas
    setInterval(loadSidebarData, 60000);
    
    // Exportar fun√ß√µes
    window.setActiveLink = window.setActiveLink;
    window.refreshSidebar = window.refreshSidebar;
    window.detectGames = window.detectGames;
    window.clearSystemCache = window.clearSystemCache;
    window.runSystemDiagnostic = window.runSystemDiagnostic;
    window.scanLibrary = window.scanLibrary;
    window.closeSidebarMobile = closeSidebarMobile;
    window.openSidebarMobile = openSidebarMobile;
    window.toggleSidebarMobile = toggleSidebarMobile;
    window.navigateTo = navigateTo;
</script>